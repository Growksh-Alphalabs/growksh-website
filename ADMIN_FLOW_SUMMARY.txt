## Admin Flow - Quick Reference

### Files Created/Modified

**NEW FILES:**
- ‚ú® `src/components/Auth/AdminLogin.jsx` - Admin login form
- ‚ú® `src/pages/AdminDashboard.jsx` - Protected admin dashboard
- ‚ú® `src/components/common/ProtectedRoute.jsx` - Route protection component
- üìÑ `docs/ADMIN_SETUP.md` - Complete admin setup guide

**MODIFIED FILES:**
- ‚úÖ `src/context/AuthContext.jsx` - Added `isAdmin` state + `extractAdminStatusFromToken()`
- ‚úÖ `src/lib/cognito.js` - Added `adminLogin()` function
- ‚úÖ `src/App.jsx` - Added admin routes with protection

---

### Key Implementation Details

#### 1. Admin Status from Cognito Groups

When admin user logs in, Cognito returns ID token with:
```json
{
  "cognito:groups": ["admin"],
  "email": "admin@growksh.com",
  "email_verified": true
}
```

AuthContext extracts this:
```javascript
extractAdminStatusFromToken(idToken) {
  const payload = JSON.parse(atob(idToken.split('.')[1]))
  return payload['cognito:groups']?.includes('admin') || false
}
```

#### 2. Route Protection

```jsx
<Route
  path="/admin/dashboard"
  element={
    <ProtectedRoute requireAdmin={true} fallbackRoute="/admin/login">
      <AdminDashboard />
    </ProtectedRoute>
  }
/>
```

ProtectedRoute checks:
- `isAuthenticated` = true (logged in)
- `isAdmin` = true (in admin group)

#### 3. Admin Login Flow

```javascript
const result = await adminLogin(email, password)
// Uses USER_PASSWORD_AUTH (not OTP)
// Validates in Cognito
// Returns tokens
// checkAuth() extracts admin status
```

---

### Access Control

| Route | Public? | Requires Auth? | Requires Admin? | Result |
|-------|---------|----------------|-----------------|--------|
| `/admin/login` | ‚úÖ Yes | ‚ùå No | ‚ùå No | Admin login form |
| `/admin/dashboard` | ‚ùå No | ‚úÖ Yes | ‚úÖ Yes | Admin panel |
| `/login` | ‚úÖ Yes | ‚ùå No | ‚ùå No | Regular OTP login |
| `/` | ‚úÖ Yes | ‚ùå No | ‚ùå No | Public home |

---

### Testing Checklist

- [ ] Admin user created in Cognito
- [ ] Admin user added to "admin" group
- [ ] USER_PASSWORD_AUTH enabled on Cognito Client
- [ ] Visit `/admin/login` - form displays
- [ ] Enter admin credentials - login successful
- [ ] Redirected to `/admin/dashboard`
- [ ] Regular user cannot access `/admin/dashboard` (shows "Access Denied")
- [ ] Logout from admin panel works
- [ ] Tokens stored in localStorage correctly

---

### Next Steps for Production

1. **Create admin users:**
   ```bash
   aws cognito-idp admin-create-user \
     --user-pool-id <POOL_ID> \
     --username admin@growksh.com \
     --temporary-password "TempPass123!"
   ```

2. **Add to admin group:**
   ```bash
   aws cognito-idp admin-add-user-to-group \
     --user-pool-id <POOL_ID> \
     --username admin@growksh.com \
     --group-name admin
   ```

3. **Set permanent password:**
   ```bash
   aws cognito-idp admin-set-user-password \
     --user-pool-id <POOL_ID> \
     --username admin@growksh.com \
     --password "SecurePassword123!" \
     --permanent
   ```

4. **Verify in SAM template:**
   ```yaml
   ExplicitAuthFlows:
     - ALLOW_USER_PASSWORD_AUTH
     - ALLOW_REFRESH_TOKEN_AUTH
   ```

5. **Deploy and test**

---

### Security Notes

‚úÖ Admin routes are **NOT public**
‚úÖ Admin routes are **protected** by ProtectedRoute component
‚úÖ Admin status is **verified on every auth check**
‚úÖ Tokens are **JWT tokens from Cognito** (server-signed)
‚úÖ Role is **server-enforced** via Cognito groups
‚úÖ Password is **hashed by Cognito** (not stored in app)

Regular users cannot:
- Access `/admin/login` (public but redirects if already logged in)
- Access `/admin/dashboard` (protected, shows "Access Denied")
- Modify their own `isAdmin` state (read-only from token)
